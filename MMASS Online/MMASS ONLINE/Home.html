<!DOCTYPE html>
<html>
<head runat="server">
    <title>MMASS Online - Inicio</title>

    <link rel="shortcut icon" href="favicon.png">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400&display=swap" rel="stylesheet">
    <script src="./js/autentificar.js"></script>


    <style>
        .table-hover tbody tr:hover > td {
            cursor: pointer;
        }

        .search-box-closed {
            width: 53px;
        }

        .input-group-addon {
            padding: 5px;
            background: #b3c1cc;
        }

        th {
            text-align: center;
        }

        .dataTitle {
            font-family: 'Roboto';
            font-size: 20px;
        }

        @media (max-width: 767px) {
            .search-box-open {
                width: 100%;
            }

            #divMessage {
                position: fixed;
                width: 100%;
                bottom: 2px;
                text-align: center;
            }
        }

        @media (min-width: 768px) {
            .search-box-open {
                width: 300px;
            }
        }

        @media screen {

            #divMessage {
                position: fixed;
                left: 50%;
                margin-left: -200px;
                width: 400px;
                bottom: 30px;
                text-align: center;
            }
        }

        .jumbotron {
            background-color: #f5f5f5 !important;
        }

        .rounded {
            border-radius: 1.5rem !important;
        }

        .btn-primary {
            color: #fff;
            background-color: #f6ab36;
            border-color: #f6ab36;
        }

            .btn-primary:hover {
                background-color: #d69126;
                border-color: #d69126;
            }

            .btn-primary:active {
                background-color: #f6ab36 !important;
                border-color: #f6ab36 !important;
            }

        .modalRangos {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }

        .btn-rangos {
            color: #000;
            background-color: #f7f7f7;
            border-bottom-color: #d8d8d8;
            /* border-right-color: #f2e9e9;*/
        }

            .btn-rangos:hover {
                background-color: #d8d8d8;
            }

    </style>

</head>
<body style="padding-top: 80px; font-family: 'Roboto';">
    <!--MENU-->
    <div id="divNavBar"></div>

    <main role="main" class="container d-flex justify-content-center">
        <div id="divBlock" style="left:0; right:0;top:0; bottom:0;overflow-x: hidden; overflow-y: auto;position:fixed;z-index:1051;outline:0;display:none"></div>

        <!-- Modal -->
        <div class="modal fade" id="modalCenter" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content shadow p-3 mb-5 bg-white rounded">
                    <div class="modal-header d-flex justify-content-center">
                        <h5 class="modal-title" id="modalCenterTitle">Advertencia</h5>
                    </div>
                    <div class="modal-body" id="modalCenterBody">

                    </div>
                    <div class="modal-footer d-flex justify-content-center" id="modalCenterFooter">

                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Rangos -->
        <div class="modal fade modalRangos" id="modalRangos" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modalRangos modal-dialog modal-xl" role="document">
                <div class="modal-content shadow p-3 mb-5 bg-white rounded">
                    <div class="modal-header d-flex justify-content-center">
                        <h5 class="modal-title" id="modalCenterTitle">
                            Seleccionar periodo
                        </h5>
                    </div>
                    <div class="modal-body" id="modalRangosBody">
                        <div class='row'>
                            <div class='col-lg-6' style='padding - right: 0px;'>
                                <select class="form-control" id="selRango" onchange="onSelRangoSelected()">
                                    <option value="0">Hoy</option>
                                    <option value="1">Ayer</option>
                                    <option value="2">Ultimos 7 días</option>
                                    <option value="3" selected>Ultimos 30 días</option>
                                    <option value="4">Ultimos 90 días</option>
                                    <option value="5">El mes pasado</option>
                                    <option value="6">Mes hasta la fecha</option>
                                    <option value="7">Trimestre hasta la fecha</option>
                                    <option value="8">Presonalizado</option>
                                </select>
                            </div>
                            <div class='col-lg-6' style='padding - left: 0px;'>
                                <div class="input-group input-daterange">
                                    <input type="text" class="form-control enterSearch" id="fechaDesde" data-toggle="datetimepicker" data-target="#fechaDesde" onchange="comprobarFechas(1)" disabled="disabled"/>
                                    <span class="input-group-addon">hasta</span>
                                    <input type="text" class="form-control enterSearch" id="fechaHasta" data-toggle="datetimepicker" data-target="#fechaHasta" onchange="comprobarFechas(2)" disabled="disabled"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-end" id="modalRangosFooter">
                        <button type="button" class="btn btn-dark" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-dark" onclick="aplicarRango()">Aplicar</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="divMessage" class="alert" style="display:none;cursor:pointer;z-index:10000;" title="Click para cerrar" onclick="$('#divMessage').hide('slideDown')"> </div>
        <div class="jumbotron mt-4 py-4 shadow p-3 mb-5 bg-white rounded" id="HomeMain">
            <!--Tipos de Avisos DATA-->
            <p class="dataTitle">INICIO</p>
            <div id="divRedesData d-flex align-items-around align-items-end">
                <div class="row">
                    <div class="card mb-3 shadow p-3 bg-white rounded" style="margin-right: 20px; margin-left: 20px; width: 1234px; ">
                        <div class="card-header d-flex align-items-center" style="margin-bottom: 1rem;">
                            <span id="headerTitle" class="dataTitle" style="margin-right: 15px;">Accesos directos</span>
                        </div>
                        <div class="card-body">
                            <div class="row py-1">
                                <div class="col-md-3">
                                    <button class="btn btn-lg btn-primary btn-block" onclick="onAccesoDir('Orden')">
                                        <span class="fa fa-plus"></span> Nueva Orden
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-lg btn-primary btn-block" onclick="onAccesoDir('OrdenList')">
                                        <span class="fa fa-th-list"></span> Ordenes
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-lg btn-primary btn-block" onclick="onAccesoDir('informeVentas')">
                                        <span class="fa fa-area-chart"></span> Informe de Ventas
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-lg btn-primary btn-block" onclick="onAccesoDir('perfil')">
                                        <span class="fa fa-id-card"></span> Mi Perfil
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="card mb-3 shadow p-3 bg-white rounded" style="margin-right: 20px; margin-left: 20px; width: 1234px; ">
                        <div class="card-header d-flex align-items-center" style="margin-bottom: 1rem;">
                            <div class="col-lg-6">
                                <row class="row py-1">
                                    <label class="dataTitle" style="margin-bottom: 0px;">Indicadores</label>
                                </row>
                                <row class="row py-1">
                                    <label id="lblRango" style="margin-top: 8px; margin-right: 3px;"></label>
                                    <button type="button" id="btnRango" class="btn btn-rangos" onclick="prevModalRangos()">
                                    </button>
                                </row> 
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row py-1">
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-money" style="padding-top: 5px;margin-right: 5px;"></span> Ingresos
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span class="dataTitle" id="spanIngresos" style=" font-size: 40px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanIngresosDif" style="font-size: 20px;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-picture-o" style="padding-top: 5px;margin-right: 5px;"></span> Impresiones
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span class="dataTitle" id="spanImpresiones" style=" font-size: 40px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanImpresionesDif" style="font-size: 20px;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-pie-chart" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> eCPM
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span class="dataTitle" id="spanEcpm" style=" font-size: 40px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanEcpmDif" style="font-size: 20px;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-th-list" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> Ordenes
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span class="dataTitle" id="spanOrdenes" style=" font-size: 40px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanOrdenesDif" style="font-size: 20px;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row py-4">
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-line-chart" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> Ranking Anunciantes
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span id="spanAnunciante0" style="font-size: 21px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanAnunciante1" style="font-size: 18px; color: #595959;">

                                            </span>
                                            <br />
                                            <span id="spanAnunciante2" style="font-size: 13px; color: #a7a7a7;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-line-chart" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> Ranking Agencias
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span id="spanAgencia0" style="font-size: 21px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanAgencia1" style="font-size: 18px; color: #595959;">

                                            </span>
                                            <br />
                                            <span id="spanAgencia2" style="font-size: 13px; color: #a7a7a7;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-line-chart" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> Ranking Medios
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span id="spanMedio0" style="font-size: 21px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanMedio1" style="font-size: 18px; color: #595959;">

                                            </span>
                                            <br />
                                            <span id="spanMedio2" style="font-size: 13px; color: #a7a7a7;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card rounded bg-transparent" style="align-items: center; border-color: #f6ab36; color: #ffffff; max-width: -webkit-fill-available; height: 152px; background-image: linear-gradient(#f6ab36 25%, #ffffff 25%); ">
                                        <div class="d-flex dataTitle" style="padding-top: 5px;">
                                            <span class="fa fa-line-chart" style="margin-bottom: 0px;padding-top: 5px;margin-right: 5px;"></span> Ranking Tipos de Avisos
                                        </div>
                                        <div class="card-body" style="text-align: center; padding-top: 10px;">
                                            <span id="spanTipoAviso0" style="font-size: 21px;color: black;">

                                            </span>
                                            <br />
                                            <span id="spanTipoAviso1" style="font-size: 18px; color: #595959;">

                                            </span>
                                            <br />
                                            <span id="spanTipoAviso2" style="font-size: 13px; color: #a7a7a7;">

                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!--Scripts-->
    <script type="text/javascript">

        //DatePickers Initialization
        $(function () {
            $('input[type=text]').attr('autocomplete', 'off');
            $("#divNavBar").load("navBar.html");
            //populateFields();
            //$(".enterSearch").on("keydown", function (e) {
            //    if (event.which == 13) {
            //        searchRedes();
            //    }
            //});
            document.body.style.backgroundImage = "url(./fondoM3.png)";
            inicializar();
        });

        function inicializar() {
            $.when(formatearDatetimepickers()).then(function () {
                $("#lblRango").text($("#selRango option:selected").text());
                $("#selRango").change();
            });
        }

        function formatearDatetimepickers() {
            var hoy = new Date();
            hoy.setUTCHours(23, 59, 59, 999);
            $('#fechaDesde').datetimepicker({ format: 'L', locale: 'es', maxDate: hoy });
            $('#fechaHasta').datetimepicker({ format: 'L', locale: 'es', maxDate: hoy });
        }

        function buscarDatosIndicadoresRanking() {
            const desdePenultimoDate = new Date();
            const hastaPenultimoDate = new Date();

            //agregamos fechas al btnRango
            $("#btnRango").html('(' + $('#fechaDesde').val() + ' - ' + $('#fechaHasta').val() + ')<span class="fa fa-caret-down" style="margin-left: 10px;"></span>');

            var desdeUltimo = dateToSqlFormat($('#fechaDesde').val());
            var hastaUltimo = dateToSqlFormat($('#fechaHasta').val());

            var desdeUltimoDate = new Date(desdeUltimo + 'T00:00:00');
            var hastaUltimoDate = new Date(hastaUltimo + 'T00:00:00');
            const diffTime = Math.abs(hastaUltimoDate - desdeUltimoDate);
            const cantDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            desdeUltimoDate.setDate(desdeUltimoDate.getDate() - (cantDias + 1));
            hastaUltimoDate.setDate(hastaUltimoDate.getDate() - (cantDias + 1));

            var desdePenultimo = formatDate2(desdeUltimoDate);
            var hastaPenultimo = formatDate2(hastaUltimoDate);

            params = {};
            params.fechaDesdeUltimo = desdeUltimo;
            params.fechaHastaUltimo = hastaUltimo;
            params.fechaDesdePenultimo = desdePenultimo;
            params.fechaHastaPenultimo = hastaPenultimo;
            var parametros = setListaParametros(params);
            //buscamos los datos indicadores
            callWS("R_Ventas", "getDatosHome", JSON.stringify(parametros), function (data) { onBuscarDatosIndicadores(data); });
            //buscamos los datos rankings
            callWS("R_Ventas", "getRankingsHome", JSON.stringify(parametros), function (data) { onBuscarDatosRankings(data); });
        }

        function onBuscarDatosIndicadores(data) {
            //Ingresos
            var ingresosDif = data[0].importe_total - data[1].importe_total;
            var ingresosDifPorc = 0;
            if (Math.abs(ingresosDif) > 0) {
                ingresosDifPorc = (Math.abs(ingresosDif) * 100) / data[1].importe_total;
            }
            var strgPorcIng = '';
            if (ingresosDifPorc > 100) {
                strgPorcIng = '>100';
            }
            else {
                strgPorcIng = ingresosDifPorc.toFixed();
            }

            var signo = setColoresDif(ingresosDif, '#spanIngresosDif');
            $("#spanIngresos").html(nFormatter(data[0].importe_total, 2) + '$');
            $("#spanIngresosDif").html(signo + nFormatter(Math.abs(ingresosDif), 2) + '$ (' + strgPorcIng + '%)');

            //Impresiones
            var impresionesDif = data[0].impresiones - data[1].impresiones;
            var impresionesDifPorc = 0;
            if (Math.abs(impresionesDif) > 0) {
                impresionesDifPorc = (Math.abs(impresionesDif) * 100) / data[1].impresiones;
            }

            var strgPorcImp = '';
            if (impresionesDifPorc > 100) {
                strgPorcImp = '>100'
            }
            else {
                strgPorcImp = impresionesDifPorc.toFixed();
            }

            var signo = setColoresDif(impresionesDif, '#spanImpresionesDif');
            $("#spanImpresiones").html(nFormatter(data[0].impresiones, 2));
            $("#spanImpresionesDif").html(signo + nFormatter(Math.abs(impresionesDif), 2) + ' (' + strgPorcImp + '%)');

            //eCPM 
            var ecpmDif = data[0].ecpm - data[1].ecpm
            var ecpmDifPorc = 0;
            if (Math.abs(ecpmDif) > 0) {
                 ecpmDifPorc = (Math.abs(ecpmDif) * 100) / data[1].ecpm;
            }
            var strgPorcEcpm = '';
            if (ecpmDifPorc > 100) {
                strgPorcEcpm = '>100'
            }
            else {
                strgPorcEcpm = ecpmDifPorc.toFixed();
            }

            var signo = setColoresDif(ecpmDif, '#spanEcpmDif');
            $("#spanEcpm").html(nFormatter(data[0].ecpm, 2) + '$');
            $("#spanEcpmDif").html(signo + nFormatter(Math.abs(ecpmDif), 2) + '$ (' + strgPorcEcpm + '%)');

            //Cantidad de Ordenes
            var ordenesDif = data[0].cantidad_ordenes - data[1].cantidad_ordenes;
            var ordenesDifPorc = 0;
            if (Math.abs(ordenesDif) > 0) {
                ordenesDifPorc = (Math.abs(ordenesDif) * 100) / data[1].cantidad_ordenes;
            }
            var strgPorcOrd = '';
            if (ordenesDifPorc > 100) {
                strgPorcOrd = '>100'
            }
            else {
                strgPorcOrd = ordenesDifPorc.toFixed();
            }

            var signo = setColoresDif(ordenesDif, '#spanOrdenesDif');
            $("#spanOrdenes").html(data[0].cantidad_ordenes);
            $("#spanOrdenesDif").html(signo + nFormatter(Math.abs(ordenesDif)) + ' (' + strgPorcOrd + '%)');
        }

        function onBuscarDatosRankings(data) {
            //Ranking Anunciantes
            llenarRanking(data, 0);

            //Ranking Agencias
            llenarRanking(data, 1);

            //Ranking Medios
            llenarRanking(data, 2);

            //Ranking Tipos Aviso
            llenarRanking(data, 3);
        }

        function llenarRanking(data, ranking) {
            for (let i = 0; i < 3; i++) {
                switch (ranking) {
                    case 0:
                        if (data[ranking][i] == null) {
                            $("#spanAnunciante" + i).html('')
                        }
                        else {
                            $("#spanAnunciante" + i).html(data[ranking][i].anunciante.slice(0, 8) + ' (' + nFormatter(data[ranking][i].importe_total, 1) + '$' + ')');
                        }
                        break;
                    case 1:
                        if (data[ranking][i] == null) {
                            $("#spanAgencia" + i).html('')
                        }
                        else {
                            $("#spanAgencia" + i).html(data[ranking][i].agencia.slice(0, 8) + ' (' + nFormatter(data[ranking][i].importe_total, 1) + '$' + ')');
                        }
                        break;
                    case 2:
                        if (data[ranking][i] == null) {
                            $("#spanMedio" + i).html('')
                        }
                        else {
                            $("#spanMedio" + i).html(data[ranking][i].medio.slice(0, 8) + ' (' + nFormatter(data[ranking][i].importe_total, 1) + '$' + ')');
                        }
                        break;
                    case 3:
                        if (data[ranking][i] == null) {
                            $("#spanTipoAviso" + i).html('')
                        }
                        else {
                            $("#spanTipoAviso" + i).html(data[ranking][i].tipo_aviso.slice(0, 8) + ' (' + nFormatter(data[ranking][i].importe_total, 1) + '$' + ')');
                        }
                        break;
                }
            }
        }

        function setColoresDif(diferencia, span) {
            var signo = '';
            if (diferencia < 0) {
                signo = '-';
                $(span).append('-');
                $(span).css("color", "crimson");
            }
            else if (diferencia == 0) {
                $(span).css("color", "cornflowerblue");
            }
            else {
                signo = '+';
                $(span).append('+');
                $(span).css("color", "forestgreen");
            }
            return signo;
        }

        function formatDate(date) {
            return [
                padTo2Digits(date.getDate()),
                padTo2Digits(date.getMonth() + 1),
                date.getFullYear(),
            ].join('/');
        }

        function formatDate2(date) {
            return [
                date.getFullYear(),
                padTo2Digits(date.getMonth() + 1),
                padTo2Digits(date.getDate()),
            ].join('/');
        }

        function padTo2Digits(num) {
            return num.toString().padStart(2, '0');
        }

        function onAccesoDir(pag) {
            location.href = '/' + pag + '.html';
        }

        function setListaParametros(data) {
            var parametros = {};
            var listaParametros = [];

            Object.keys(data).forEach(function (key) {
                var objParametro = {};
                objParametro.ParameterName = key;
                objParametro.Value = data[key];
                listaParametros.push(objParametro);
            });
            parametros.Parametros = listaParametros;
            return parametros;
        }

        function nFormatter(num, digits) {
            const lookup = [
                { value: 1, symbol: "" },
                { value: 1e3, symbol: "mil" },
                { value: 1e6, symbol: "M" },
                { value: 1e9, symbol: "G" },
                { value: 1e12, symbol: "T" },
                { value: 1e15, symbol: "P" },
                { value: 1e18, symbol: "E" }
            ];
            const rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
            var item = lookup.slice().reverse().find(function (item) {
                return num >= item.value;
            });
            return item ? (num / item.value).toFixed(digits).replace(rx, "$1").replace(".", ",") + " " + item.symbol : "0";
        }

        function dateToSqlFormat(date) {
            arr = date.split("/");
            sqlFormatDate = '';
            sqlFormatDate = arr[2] + '-' + arr[1] + '-' + arr[0];
            return sqlFormatDate;
        }

        function dateToFieldFormat(date) {
            date = date.split('T')[0];
            arr = date.split("-");
            fieldFormatDate = '';
            fieldFormatDate = arr[2] + '/' + arr[1] + '/' + arr[0];
            return fieldFormatDate;
        }

        function prevModalRangos() {
            $("#modalRangos").modal('show')
        }

        function onSelRangoSelected() {
            var rangoValue = $('#selRango').val();
            const hoy = new Date();
            let ayer = new Date(hoy);
            ayer.setDate(ayer.getDate() - 1);

            switch (rangoValue) {
                case '0':
                    //hoy
                    $('#fechaDesde').datetimepicker('date', moment(hoy, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(hoy, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '1':
                    //ayer
                    $('#fechaDesde').datetimepicker('date', moment(ayer, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(ayer, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '2':
                    //ultimos 7 dias
                    let sieteDias = new Date(hoy);
                    sieteDias.setDate(sieteDias.getDate() - 7);
                    $('#fechaDesde').datetimepicker('date', moment(sieteDias, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(ayer, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '3':
                    //ultimos 30 dias
                    let treintaDias = new Date(hoy);
                    treintaDias.setDate(treintaDias.getDate() - 30);
                    $('#fechaDesde').datetimepicker('date', moment(treintaDias, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(ayer, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '4':
                    //ultimos 90 dias
                    let noventaDias = new Date(hoy);
                    noventaDias.setDate(noventaDias.getDate() - 90);
                    $('#fechaDesde').datetimepicker('date', moment(noventaDias, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(ayer, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '5':
                    //el mes pasado
                    var mesPasado = new Date();
                    mesPasado.setDate(0); // 0 devuelve el ultimo dia del mes pasado
                    $('#fechaHasta').datetimepicker('date', moment(mesPasado, 'DD/MM/YYYY'));
                    mesPasado.setDate(1); // 1 devuelve el primer dia del mes pasado
                    $('#fechaDesde').datetimepicker('date', moment(mesPasado, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '6':
                    //mes hasta la fecha
                    var primerDiaMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
                    $('#fechaDesde').datetimepicker('date', moment(primerDiaMes, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(hoy, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '7':
                    //trimestre hasta la fecha
                    const trimestre = Math.floor((hoy.getMonth() / 3));
                    const primerDiaTrimestre = new Date(hoy.getFullYear(), trimestre * 3, 1);
                    $('#fechaDesde').datetimepicker('date', moment(primerDiaTrimestre, 'DD/MM/YYYY'));
                    $('#fechaHasta').datetimepicker('date', moment(hoy, 'DD/MM/YYYY'));
                    $("#fechaDesde").attr("disabled", true);
                    $("#fechaHasta").attr("disabled", true);
                    aplicarRango(); 
                    break;
                case '8':
                    //personalizado
                    $("#fechaDesde").attr("disabled", false);
                    $("#fechaHasta").attr("disabled", false);
                    break;
            }
        }

        function aplicarRango() {
//            if (!validarFechas()) { return false; }

            $("#lblRango").text($("#selRango option:selected").text());
            $("#btnRango").html('(' + $('#fechaDesde').val() + ' - ' + $('#fechaHasta').val() + ')<span class="fa fa-caret-down" style="margin-left: 10px;"></span>');
            buscarDatosIndicadoresRanking();

            $("#modalRangos").modal('hide')
        } 

        function comprobarFechas(selector) {
            var o1 = new Date(dateToSqlFormat($('#fechaDesde').val()) + 'T00:00:00');
            var o2 = new Date(dateToSqlFormat($('#fechaHasta').val()) + 'T00:00:00');
            if (o2 < o1) {
                //si fechaDesde < fechaHasta, entonces de setea la fecha seleccionada en fechaDesde en fechaHasta
                if (selector == 1) {
                    $("#fechaHasta").val($("#fechaDesde").val());
                }
                //si fechaHasta < fechaDesde, entonces de setea la fecha seleccionada en fechaHasta en fechaDesde
                else {
                    $("#fechaDesde").val($("#fechaHasta").val());
                }
            }
        }

        function validarFechas() {
            if ($('#fechaDesde').val() != "") {
                fDesde = new Date(moment($("#fechaDesde").val(), 'DD/MM/YYYY', true).format());
                mfDesde = moment(fDesde);
                if (mfDesde.isValid() == false) {
                    showMessage("Seleccione una fecha válida para el periodo", "info");
                    return false;
                }
            }
            else {
                showMessage("Seleccione una fecha para el periodo", "info");
                return false;
            }

            if ($('#fechaHasta').val() != "") {
                fHasta = new Date(moment($("#fechaHasta").val(), 'DD/MM/YYYY', true).format());
                mfHasta = moment(fHasta);
                if (mfHasta.isValid() == false) {
                    showMessage("Seleccione una fecha válida para el periodo", "info");
                    return false;
                }
            }
            else {
                showMessage("Seleccione una fecha para el periodo", "info");
                return false;
            }

            return true;
        }

    </script>
    <footer>
        <p style="text-align: center; font-size: x-small;">Powered by <b style="font-size: small;">Strategy Zone S.A. ©</b></p>
    </footer>
</body>
</html>