<!DOCTYPE html>
<html>
<head runat="server">
    <title>MMASS Online - Configuración</title>

    <link rel="shortcut icon" href="favicon.png">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400&display=swap" rel="stylesheet">
    <script src="./js/autentificar.js"></script>


    <style>
        .table-hover tbody tr:hover > td {
            cursor: pointer;
        }

        .search-box-closed {
            width: 53px;
        }

        th {
            text-align: center;
        }

        .dataTitle {
            font-family: 'Roboto';
            font-size: 20px;
        }

        @media (max-width: 767px) {
            .search-box-open {
                width: 100%;
            }

            #divMessage {
                position: fixed;
                width: 100%;
                bottom: 2px;
                text-align: center;
            }
        }

        @media (min-width: 768px) {
            .search-box-open {
                width: 300px;
            }
        }

        @media screen {

            #divMessage {
                position: fixed;
                left: 50%;
                margin-left: -200px;
                width: 400px;
                bottom: 30px;
                text-align: center;
            }
        }

        .jumbotron {
            background-color: #f5f5f5 !important;
        }

        .rounded {
            border-radius: 1.5rem !important;
        }

        /*Botón activado/desactivado conexión content admanager*/
        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #343a40;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #343a40;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        a, a:hover {
            color: #333
        }

        .btn-danger {
            color: #fff;
            background-color: #fc9a00;
            border-color: #fc9a00
        }

        .btn-danger:hover {
            color: #fff;
            background-color: #e08902;
            border-color: #e08902
        }

    </style>

</head>
<body style="padding-top: 80px; font-family: 'Roboto';">
    <!--MENU-->
    <div id="divNavBar"></div>

    <main role="main" class="container d-flex justify-content-center">
        <div id="divBlock" style="left:0; right:0;top:0; bottom:0;overflow-x: hidden; overflow-y: auto;position:fixed;z-index:1051;outline:0;display:none"></div>

        <!-- Modal -->
        <div class="modal fade" id="modalCenter" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content shadow p-3 mb-5 bg-white rounded">
                    <div class="modal-header d-flex justify-content-center">
                        <h5 class="modal-title" id="modalCenterTitle">Advertencia</h5>
                    </div>
                    <div class="modal-body" id="modalCenterBody">

                    </div>
                    <div class="modal-footer d-flex justify-content-center" id="modalCenterFooter">

                    </div>
                </div>
            </div>
        </div>

        <!--Modal Configuracion Mail-->
        <div class="modal fade" id="configMailModal" style="overflow-y: auto">
            <div class="modal-dialog modal-xl modalConv">
                <div class="modal-content shadow p-3 mb-5 bg-white rounded">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="configMailTitle">CONFIGURAR CUENTA DE MAIL</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body" id="configMailBody">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="mail">Mail Remitente</label>
                                <div class="input-group">
                                    <input type="email" id="mail" class="form-control readonlyOnView" placeholder="Mail">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <label for="pass"> Contraseña</label>
                                <div class="input-group" id="show_hide_password">
                                    <input class="form-control readonlyOnView" type="password" autocomplete="new-password" id="pass" placeholder="Contraseña">
                                    <div class="input-group-text">
                                        <a href="" title="Mostrar contraseña"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="servidor">Servidor SMTP</label>
                                <div class="input-group">
                                    <input type="text" id="servidor" class="form-control readonlyOnView" placeholder="Servidor">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <label for="puerto">Puerto SMTP</label>
                                <div class="input-group">
                                    <input type="number" id="puerto" class="form-control readonlyOnView" placeholder="Puerto">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 7px;">
                            <div class="col-lg-4">
                                <button type="button" class="btn btn-dark btn-sm mx-1" onclick="probarMail()" style="height: 34px;" title='Enviar mail de prueba'>
                                    <span class="fa fa-plug"></span> Probar
                                </button>
                            </div>
                            <div class="col-lg-4">
                                <div class="input-group">
                                    <input type="hidden" id="idMail" class="form-control readonlyOnView" disabled="disabled">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-dark" onclick="guardarMail()">Guardar</button>
                        <button type="button" class="btn btn-dark" data-dismiss="modal">Cerrar</button>
                    </div>

                </div>
            </div>
        </div>

        <!--Modal Destinatarios-->
        <div class="modal fade" id="destinatariosModal">
            <div class="modal-dialog modal-xl modalConv">
                <div class="modal-content shadow p-3 mb-5 bg-white rounded">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="destinatariosModalTitle">DESTINATARIOS</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body" id="destinatariosModalBody">                      
                        <!--Tabla-->
                        <div class="table-responsive mt-2 tableFixHead">
                            <table class="table table-fixed table-striped" id="tDestinatarios">
                                <thead class="thead-dark">
                                    <tr>
                                        <th class="col-xs-3" style="text-align: center;">#</th>
                                        <th class="col-xs-2" style="text-align: center;">Nombre</th>
                                        <th class="col-xs-2" style="text-align: center;">Usuario</th>
                                        <th class="col-xs-1" style="text-align: center;">Mail</th>
                                        <th class="col-xs-1" style="text-align: center;">Enviar</th>
                                    </tr>
                                </thead>
                                <tbody id="TableDestinatarios"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                    </div>

                </div>
            </div>
        </div>


        <div id="divMessage" class="alert" style="display:none;cursor:pointer;z-index:10000;" title="Click para cerrar" onclick="$('#divMessage').hide('slideDown')"> </div>
        <div class="jumbotron mt-4 py-4 col-lg-9 shadow p-3 mb-5 bg-white rounded" id="divTiposAvisosMain">
            <!--Configuracion DATA-->
            <p class="dataTitle">CONFIGURACION</p>
            <div id="divRedesData d-flex align-items-around align-items-end">
                <div class="row py-1 ocultar" style="height: 50px;">
                    <div class="col-md-6">
                        <label>Desbloqueo de Ordenes</label>
                    </div>
                    <div class="col-md-6">
                        <button type="button" class="btn btn-dark btn-sm mx-1" onclick="desbloquearOP()" style="height: 34px;">
                            <span class="fa fa-unlock"></span> Desbloquear
                        </button>
                    </div>
                </div>
                <div id="divMultimoneda" class="ocultar">
                    <div class="row py-1">
                        <div class="col-md-6">
                            <label>Multimoneda</label>
                        </div>
                        <div class="col-md-6">
                            <label class="switch">
                                <input type="checkbox" id="checkMulti" onclick="checkParam(5, 'checkMulti')">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="row py-1 ocultar">
                    <div class="col-md-6">
                        <label>OP lista para facturar por defecto</label>
                    </div>
                    <div class="col-md-6">
                        <label class="switch">
                            <input type="checkbox" id="checkListaParaFac" onclick="checkParam(4, 'checkListaParaFac')">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="row py-1 ocultar">
                    <div class="col-md-6">
                        <label>Sincronización automática con AdServer</label>
                    </div>
                    <div class="col-md-6">
                        <label class="switch">
                            <input type="checkbox" id="checkPermitirSinc" onclick="permitirSinc()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div id="rowSincDet" class="ocultar">
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkCreSinc" style="margin-bottom: .8rem; margin-right: .2rem" onclick="permitirSincD()">
                            <label for="checkCreSinc">Creación de Línea de Pedido</label>
                        </div>
                    </div>
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkModSinc" style="margin-bottom: .8rem; margin-right: .2rem" onclick="permitirSincD()">
                            <label for="checkModSinc">Modificación de Línea de Pedido</label>
                        </div>
                    </div>
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkArcSinc" style="margin-bottom: .8rem; margin-right: .2rem" onclick="permitirSincD()">
                            <label for="checkArcSinc">Archivado de Línea de Pedido</label>
                        </div>
                    </div>
                </div>
                <div class="row py-1 ocultar">
                    <div class="col-md-6">
                        <label>Notificaciones por Mail</label>
                    </div>
                    <div class="col-md-6">
                        <label class="switch">
                            <input type="checkbox" id="checkActivarMail" onclick="activarMail()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div id="rowNotDet" class="ocultar">
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkCre" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailD()">
                            <label for="checkCre">Creación de Línea de Pedido</label>
                        </div>
                    </div>
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkMod" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailD()">
                            <label for="checkMod">Modificación de Línea de Pedido</label>
                        </div>
                    </div>
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkArc" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailD()">
                            <label for="checkArc">Archivado de Línea de Pedido</label>
                        </div>
                    </div>
                    <div class="row py-1 ocultar">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn btn-dark btn-sm mx-1" onclick="configCuentaMail()" style="height: 34px;">
                                <span class="fa fa-envelope"></span> Configurar cuenta
                            </button>
                        </div>
                        <div class="col-md-3" style="padding-left: 0px;">
                            <button type="button" class="btn btn-dark btn-sm mx-1" onclick="destMail()" style="height: 34px;">
                                <span class="fa fa-envelope-open"></span> Destinatarios
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row py-1">
                    <div class="col-md-6">
                        <label>Notificaciones por Mail</label>
                    </div>
                    <div class="col-md-6">
                        <label class="switch">
                            <input type="checkbox" id="checkActivarMailP" onclick="activarMailP()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div id="rowNotDetP">
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkCreP" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailDP()">
                            <label for="checkCreP">Creación de Presupuesto</label>
                        </div>
                    </div>
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkModP" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailDP()">
                            <label for="checkModP">Modificación Presupuesto</label>
                        </div>
                    </div>
                    <!--<div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6">
                            <input type="checkbox" id="checkArcP" style="margin-bottom: .8rem; margin-right: .2rem" onclick="activarMailDP()">
                            <label for="checkArcP">Archivado de Línea de Pedido</label>
                        </div>
                    </div>-->
                    <div class="row py-1">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn btn-dark btn-sm mx-1" onclick="configCuentaMail()" style="height: 34px;">
                                <span class="fa fa-envelope"></span> Configurar cuenta
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!--Scripts-->
    <script type="text/javascript">

        //DatePickers Initialization
        $(function () {
            $('input[type=text]').attr('autocomplete', 'off');
            //$('input[type=email]').attr('autocomplete', 'off');
            //$('input[type=password]').attr('autocomplete', 'off');
            $("#divNavBar").load("navBar.html");
            document.body.style.backgroundImage = "url(./fondoM3.png)";
            //Se buscan los valores para inicializar los parámetros en BD
            callWS("medios", "getParamById", JSON.stringify(5), function (parMulti) { iniCheckParametros(parMulti, "checkMulti"); });
            callWS("medios", "getParamById", JSON.stringify(4), function (parLista) { iniCheckParametros(parLista, "checkListaParaFac"); });
            callWS("medios", "getParamById", JSON.stringify(2), function (parSinc) { iniPermitirSinc(parSinc, "checkPermitirSinc"); });
            callWS("medios", "getParamById", JSON.stringify(3), function (parMail) { iniActMail(parMail, "checkActivarMail"); });
            //si es admin
            if (getUserRol() == 1) {
                $("#divMultimoneda").show();
            }
            else {
                $("#divMultimoneda").hide();
            }

            //ocultar configuraciones para presupuestador
            callWS("medios", "getParamById", JSON.stringify(1), function (bd) {
                if (bd.valor == 3) {
                    $('.ocultar').attr('hidden', 'hidden');
                    callWS("medios", "getParamById", JSON.stringify(7), function (parMail) { iniActMailP(parMail, "checkActivarMailP"); });
                }
                //else {
                //    $('#navbardropPresup').attr('hidden', 'hidden');
                //}
            });
        });

        function iniCheckParametros(param, check) {
            if (param.valor == 1) {
                $("#" + check)[0].checked = true;
                $("#" + check).change();
            }
            else {
                $("#" + check)[0].checked = false;
                $("#" + check).change();
            }
        }

        function iniPermitirSinc(param, check) {
            var valor = param.valor;
            switch (valor) {
                case '0':
                    $("#" + check)[0].checked = false;
                    $("#" + check).change();
                    $("#rowSincDet").hide();

                    $("#checkCreSinc")[0].checked = false;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = false;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = false;
                    $("#checkArcSinc").change();
                    break;
                case '1':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = true;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = true;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = true;
                    $("#checkArcSinc").change();
                    break;
                case '2':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = true;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = false;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = false;
                    $("#checkArcSinc").change();
                    break;
                case '3':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = false;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = true;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = false;
                    $("#checkArcSinc").change();
                    break;
                case '4':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = false;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = false;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = true;
                    $("#checkArcSinc").change();
                    break;
                case '5':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = true;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = true;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = false;
                    $("#checkArcSinc").change();
                    break;
                case '6':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = true;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = false;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = true;
                    $("#checkArcSinc").change();
                    break;
                case '7':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreSinc")[0].checked = false;
                    $("#checkCreSinc").change();
                    $("#checkModSinc")[0].checked = true;
                    $("#checkModSinc").change();
                    $("#checkArcSinc")[0].checked = true;
                    $("#checkArcSinc").change();
                    break;
            }         
        }

        function iniActMail(param, check) {
            var valor = param.valor;
            switch (valor) {
                case '0':
                    $("#" + check)[0].checked = false;
                    $("#" + check).change();
                    $("#rowNotDet").hide();

                    $("#checkCre")[0].checked = false;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = false;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = false;
                    $("#checkArc").change();                   
                break;
                case '1':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = true;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = true;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = true;
                    $("#checkArc").change();
                break;
                case '2':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = true;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = false;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = false;
                    $("#checkArc").change();
                break;
                case '3':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = false;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = true;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = false;
                    $("#checkArc").change();
                break;
                case '4':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = false;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = false;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = true;
                    $("#checkArc").change();
                break;
                case '5':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = true;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = true;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = false;
                    $("#checkArc").change();
                break;
                case '6':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = true;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = false;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = true;
                    $("#checkArc").change();
                break;
                case '7':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCre")[0].checked = false;
                    $("#checkCre").change();
                    $("#checkMod")[0].checked = true;
                    $("#checkMod").change();
                    $("#checkArc")[0].checked = true;
                    $("#checkArc").change();
                break;
            }         
        }

        function iniActMailP(param, check) {
            var valor = param.valor;
            switch (valor) {
                case '0':
                    $("#" + check)[0].checked = false;
                    $("#" + check).change();
                    $("#rowNotDetP").hide();

                    $("#checkCreP")[0].checked = false;
                    $("#checkCreP").change();
                    $("#checkModP")[0].checked = false;
                    $("#checkModP").change();
                    //$("#checkArc")[0].checked = false;
                    //$("#checkArc").change();
                    break;
                case '1':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreP")[0].checked = true;
                    $("#checkCreP").change();
                    $("#checkModP")[0].checked = true;
                    $("#checkModP").change();
                    //$("#checkArc")[0].checked = true;
                    //$("#checkArc").change();
                    break;
                case '2':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreP")[0].checked = true;
                    $("#checkCreP").change();
                    $("#checkModP")[0].checked = false;
                    $("#checkModP").change();
                    //$("#checkArc")[0].checked = false;
                    //$("#checkArc").change();
                    break;
                case '3':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreP")[0].checked = false;
                    $("#checkCreP").change();
                    $("#checkModP")[0].checked = true;
                    $("#checkModP").change();
                    //$("#checkArc")[0].checked = false;
                    //$("#checkArc").change();
                    break;
                //case '4':
                //    $("#" + check)[0].checked = true;
                //    $("#" + check).change();

                //    $("#checkCre")[0].checked = false;
                //    $("#checkCre").change();
                //    $("#checkMod")[0].checked = false;
                //    $("#checkMod").change();
                //    $("#checkArc")[0].checked = true;
                //    $("#checkArc").change();
                //    break;
                case '5':
                    $("#" + check)[0].checked = true;
                    $("#" + check).change();

                    $("#checkCreP")[0].checked = true;
                    $("#checkCreP").change();
                    $("#checkModP")[0].checked = true;
                    $("#checkModP").change();
                    //$("#checkArc")[0].checked = false;
                    //$("#checkArc").change();
                    break;
                //case '6':
                //    $("#" + check)[0].checked = true;
                //    $("#" + check).change();

                //    $("#checkCre")[0].checked = true;
                //    $("#checkCre").change();
                //    $("#checkMod")[0].checked = false;
                //    $("#checkMod").change();
                //    $("#checkArc")[0].checked = true;
                //    $("#checkArc").change();
                //    break;
                //case '7':
                //    $("#" + check)[0].checked = true;
                //    $("#" + check).change();

                //    $("#checkCre")[0].checked = false;
                //    $("#checkCre").change();
                //    $("#checkMod")[0].checked = true;
                //    $("#checkMod").change();
                //    $("#checkArc")[0].checked = true;
                //    $("#checkArc").change();
                //    break;
            }
        }

        function desbloquearOP() {
            var idUsuario = $("#NombreUsuario").attr("data-id");
            callWS("dg_orden_pub_aps", "desbloquearTodas", JSON.stringify(idUsuario), function (data) { onDesbloquearOP(data); });
        }

        function onDesbloquearOP(resultado) {
            if (resultado == true) {
                showMessage("Se han desbloqueado todas las Ordenes");
            }
            else {
                showMessage("Ocurrió un error al intentar desbloquear los Ordenes", "error");
            }
        }

        function checkParam(idParam, checkParam) {
            param = {};
            param.id_parametro = idParam;
            param.valor = 0;
            if (document.getElementById(checkParam).checked == true) {
                param.valor = 1;
            }
            callWS("medios", "cambiarParam", JSON.stringify(param), function (data) { onCheckParam(data, param); });
        }

        function onCheckParam(resultado, param) {
            //OP Lista para facturar por defecto
            if (param.id_parametro == 4) {
                if (resultado == true) {
                    if (param.valor == 0) {
                        showMessage("OP Lista para facturar por defecto Desactivada", "info");
                    }
                    else {
                        showMessage("OP Lista para facturar por defecto Activada", "info");
                    }
                }
                else {
                    if (param.valor == 0) {
                        showMessage("Ocurrió un error al intentar desactivar la OP Lista para facturar por defecto", "error");
                    }
                    else {
                        showMessage("Ocurrió un error al intentar activar la OP Lista para facturar por defecto", "error");
                    }
                }
            }
            //Multimoneda
            else if (param.id_parametro == 5) {
                if (resultado == true) {
                    if (param.valor == 0) {
                        showMessage("Multimoneda Desactivado", "info");
                    }
                    else {
                        showMessage("Multimoneda Activado", "info");
                    }
                }
                else {
                    if (param.valor == 0) {
                        showMessage("Ocurrió un error al intentar desactivar Multimoneda", "error");
                    }
                    else {
                        showMessage("Ocurrió un error al intentar activar Multimoneda", "error");
                    }
                }
            }           
        }

        function listaParaFac() {
            param = {};
            param.id_parametro = 4;
            param.valor = 0;
            if (document.getElementById("checkListaParaFac").checked == true) {
                param.valor = 1;
            }
            callWS("medios", "cambiarParam", JSON.stringify(param), function (data) { onListaParaFac(data, param); });
        }

        function onListaParaFac(resultado, param) {
            if (resultado == true) {
                if (param.valor == 0) {
                    showMessage("OP Lista para facturar por defecto Desactivada", "info");
                }
                else {
                    showMessage("OP Lista para facturar por defecto Activada", "info");
                }
            }
            else {
                if (param.valor == 0) {
                    showMessage("Ocurrió un error al intentar desactivar la OP Lista para facturar por defecto", "error");
                }
                else {
                    showMessage("Ocurrió un error al intentar activar la OP Lista para facturar por defecto", "error");
                }
            }
        }

        function permitirSinc() {
            param = {};
            param.id_parametro = 2;
            param.valor = 0;
            if (document.getElementById("checkPermitirSinc").checked == true) {
                param.valor = 1;
                //se muestra el detalle de sincronización
                $("#checkCreSinc")[0].checked = true;
                $("#checkCreSinc").change();
                $("#checkModSinc")[0].checked = true;
                $("#checkModSinc").change();
                $("#checkArcSinc")[0].checked = true;
                $("#checkArcSinc").change();

                $("#rowSincDet").show();
            }
            else {
                //se oculta el detalle de sincronización
                $("#rowSincDet").hide();

                $("#checkCreSinc")[0].checked = false;
                $("#checkCreSinc").change();
                $("#checkModSinc")[0].checked = false;
                $("#checkModSinc").change();
                $("#checkArcSinc")[0].checked = false;
                $("#checkArcSinc").change();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param), function (data) { onPermitirSinc(data, param); });
        }

        function onPermitirSinc(resultado, param) {
            if (resultado == true) {
                if (param.valor == 0) {
                    showMessage("Sincronización con AdServer Desactivada", "info");
                }
                else {
                    showMessage("Sincronización con AdServer Activada", "info");
                }
            }
            else {
                if (param.valor == 0) {
                    showMessage("Ocurrió un error al intentar desactivar la sincronización", "error");
                }
                else {
                    showMessage("Ocurrió un error al intentar activar la sincronización", "error");
                }
            }
        }

        function permitirSincD() {
            param = {};
            param.id_parametro = 2;
            param.valor;
            //envía todas
            if (document.getElementById("checkCreSinc").checked == true && document.getElementById("checkModSinc").checked == true && document.getElementById("checkArcSinc").checked == true) {
                param.valor = 1;
            }
            //envía creacion
            else if (document.getElementById("checkCreSinc").checked == true && document.getElementById("checkModSinc").checked == false && document.getElementById("checkArcSinc").checked == false) {
                param.valor = 2;
            }
            //envía modificacion
            else if (document.getElementById("checkCreSinc").checked == false && document.getElementById("checkModSinc").checked == true && document.getElementById("checkArcSinc").checked == false) {
                param.valor = 3;
            }
            //envía archivado
            else if (document.getElementById("checkCreSinc").checked == false && document.getElementById("checkModSinc").checked == false && document.getElementById("checkArcSinc").checked == true) {
                param.valor = 4;
            }
            //envía creacion y modificacion
            else if (document.getElementById("checkCreSinc").checked == true && document.getElementById("checkModSinc").checked == true && document.getElementById("checkArcSinc").checked == false) {
                param.valor = 5;
            }
            //envía creacion y archivado
            else if (document.getElementById("checkCreSinc").checked == true && document.getElementById("checkModSinc").checked == false && document.getElementById("checkArcSinc").checked == true) {
                param.valor = 6;
            }
            //envía modificacion y archivado
            else if (document.getElementById("checkCreSinc").checked == false && document.getElementById("checkModSinc").checked == true && document.getElementById("checkArcSinc").checked == true) {
                param.valor = 7;
            }
            //no envía
            else {
                param.valor = 0;
                $("#checkPermitirSinc")[0].checked = false;
                $("#checkPermitirSinc").change();
                $("#rowSincDet").hide();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param));
        }

        function activarMail() {
            param = {};
            param.id_parametro = 3;
            param.valor = 0;
            if (document.getElementById("checkActivarMail").checked == true) {
                param.valor = 1;
                //se muestra el detalle de notificaciones
                $("#checkCre")[0].checked = true;
                $("#checkCre").change();
                $("#checkMod")[0].checked = true;
                $("#checkMod").change();
                $("#checkArc")[0].checked = true;
                $("#checkArc").change();

                $("#rowNotDet").show();
            }
            else {
                //se oculta el detalle de notificaciones
                $("#rowNotDet").hide();

                $("#checkCre")[0].checked = false;
                $("#checkCre").change();
                $("#checkMod")[0].checked = false;
                $("#checkMod").change();
                $("#checkArc")[0].checked = false;
                $("#checkArc").change();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param), function (data) { onActivarMail(data, param); });
        }

        function onActivarMail(resultado, param) {
            if (resultado == true) {
                if (param.valor == 0) {
                    showMessage("Notificaciones por mail Desactivadas", "info");
                }
                else {
                    showMessage("Notificaciones por mail Activadas", "info");
                }
            }
            else {
                if (param.valor == 0) {
                    showMessage("Ocurrió un error al intentar desactivar las notificaciones", "error");
                }
                else {
                    showMessage("Ocurrió un error al intentar activar las notificaciones", "error");
                }
            }
        }

        function activarMailD() {
            param = {};
            param.id_parametro = 3;
            param.valor;
            //envía todas
            if (document.getElementById("checkCre").checked == true && document.getElementById("checkMod").checked == true && document.getElementById("checkArc").checked == true) {
                param.valor = 1;
            }
            //envía creacion
            else if (document.getElementById("checkCre").checked == true && document.getElementById("checkMod").checked == false && document.getElementById("checkArc").checked == false) {
                param.valor = 2;
            }
            //envía modificacion
            else if (document.getElementById("checkCre").checked == false && document.getElementById("checkMod").checked == true && document.getElementById("checkArc").checked == false) {
                param.valor = 3;
            }
            //envía archivado
            else if (document.getElementById("checkCre").checked == false && document.getElementById("checkMod").checked == false && document.getElementById("checkArc").checked == true) {
                param.valor = 4;
            }
            //envía creacion y modificacion
            else if (document.getElementById("checkCre").checked == true && document.getElementById("checkMod").checked == true && document.getElementById("checkArc").checked == false) {
                param.valor = 5;
            }
            //envía creacion y archivado
            else if (document.getElementById("checkCre").checked == true && document.getElementById("checkMod").checked == false && document.getElementById("checkArc").checked == true) {
                param.valor = 6;
            }
            //envía modificacion y archivado
            else if (document.getElementById("checkCre").checked == false && document.getElementById("checkMod").checked == true && document.getElementById("checkArc").checked == true) {
                param.valor = 7;
            }
            //no envía
            else {
                param.valor = 0;
                $("#checkActivarMail")[0].checked = false;
                $("#checkActivarMail").change();
                $("#rowNotDet").hide();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param));
        }

        function configCuentaMail() {
            callWS("googleAdManager", "getMailCta", "", function (mailCta) { onGetMailCta(mailCta); });
        }

        function onGetMailCta(mailCta) {
            if (mailCta.idMail == null) {
                $('#idMail').attr("value", 0);
            }
            else {
                $('#idMail').attr("value", mailCta.idMail);
            }
            $('#mail').attr("value", mailCta.dirMail);
/*            $('#mail').attr('placeholder', mailCta.dirMail)*/
            $('#pass').attr("value", mailCta.pass);
/*            $('#pass').attr("placeholder", mailCta.pass);*/
            $('#servidor').attr("value", mailCta.servidor);
/*            $('#servidor').attr("placeholder", mailCta.servidor);*/
            $('#puerto').attr("value", mailCta.puerto);
/*           $('#puerto').attr("placeholder", mailCta.puerto);*/

            $("#configMailModal").modal('show');
        }

        function guardarMail() {
            var data = {};
            var error = [];
            if ($("#mail").val() == "") {
                error.push("Mail");
            }
            if ($("#pass").val() == "") {
                error.push("Password");
            }
            if ($("#servidor").val() == "") {
                error.push("Servidor");
            }
            if ($("#puerto").val() == "") {
                error.push("Puerto");
            }

            if (error.length == 0) {
                data.idMail = $('#idMail').attr("value");
                data.dirMail = $('#mail').val();
                data.pass = $("#pass").val();
                data.servidor = $('#servidor').val();
                data.puerto = $('#puerto').val();

                callWS("googleAdManager", "saveMail", JSON.stringify(data), function (resp) {
                    if (resp == true) {
                        showMessage("Datos guardados con éxito");
                    }
                    else {
                        showMessage("Ocurrió un error al intentar guardar los datos", "error");
                        console.log(resp);
                    }
                });

            } else {
                message = "Falta completar/indicar los siguientes datos: "
                error.forEach(function (err) {
                    message += err + " - ";
                });
                message = message.slice(0, -3);
                showMessage(message, "error");
            }
        }

        function destMail() {
            callWS("users", "getAllUsers", '', function (data) { onPopulateTableDestinatarios(data); });
        }

        function onPopulateTableDestinatarios(data) {
            rowHTML = ''

            $.each(data, function (it, usuario) {

                rowHTML += "<tr>";
                rowHTML += "<td class='col-xs-1' align='center'>" + (it + 1) + "</td>";
                rowHTML += "<td class='col-xs-1' style='text-align: center;'> " + usuario.nombrel + "</td >";
                rowHTML += "<td class='col-xs-1' style='text-align: center;'> " + usuario.nombre + "</td >";
                rowHTML += "<td class='col-xs-1' style='text-align: center;'> " + usuario.email + "</td >";
                if (usuario.ambito == 0) {
                    if (usuario.email == '') {
                        rowHTML += "<td class='col-xs-1' style='text-align: center;'><input type='checkbox' style='margin - top: .4rem; margin - right: .2rem' class='form - check - input float - sm - left' id='check" + usuario.id_usuario + "' onclick='seleccionarUsuario(" + usuario.id_usuario + ")' disabled='disabled'></td >";
                    }
                    else {
                        rowHTML += "<td class='col-xs-1' style='text-align: center;'><input type='checkbox' style='margin - top: .4rem; margin - right: .2rem' class='form - check - input float - sm - left' id='check" + usuario.id_usuario + "' onclick='seleccionarUsuario(" + usuario.id_usuario + ")'></td >";
                    }
                }
                else {
                    rowHTML += "<td class='col-xs-1' style='text-align: center;'><input type='checkbox' style='margin - top: .4rem; margin - right: .2rem' class='form - check - input float - sm - left' id='check" + usuario.id_usuario + "' onclick='seleccionarUsuario(" + usuario.id_usuario + ")' checked></td >";
                }
                rowHTML += "</tr>";
            });

            $("#TableDestinatarios").html(rowHTML);

            $("#destinatariosModal").modal('show');

        }

        function seleccionarUsuario(id) {
            var data = {};
            data.id_usuario = id;
            if (document.getElementById("check" + id).checked == true) {
                data.Ambito = 1;
            }
            else {
                data.Ambito = 0;
            }

            callWS("users", "updateAlerta", JSON.stringify(data), function (resp) {
                if (resp == 0) {
                    showMessage("Usuario actualizado", "info");
                }
                else {
                    showMessage("Ocurrió un error al intentar actualizar el Usuario", "error");
                }
            });
        }

        function probarMail() {
            callWS("googleAdManager", "pruebaMail", "", function (resp) {
                if (resp == "") {
                    showMessage("Mail de prueba enviado", "success");
                }
                else {
                    showMessage("Ocurrió un error al intentar enviar el mail de prueba (" + resp + "), verifique los datos ingresados", "error");
                }
            });
        }

        //Icono ver password:
        $(document).ready(function () {
            $("#show_hide_password a").on('click', function (event) {
                event.preventDefault();
                if ($('#show_hide_password input').attr("type") == "text") {
                    $('#show_hide_password input').attr('type', 'password');
                    $('#show_hide_password i').addClass("fa-eye-slash");
                    $('#show_hide_password i').removeClass("fa-eye");
                    $('#show_hide_password a').prop('title', 'Mostrar contraseña');
                } else if ($('#show_hide_password input').attr("type") == "password") {
                    $('#show_hide_password input').attr('type', 'text');
                    $('#show_hide_password i').removeClass("fa-eye-slash");
                    $('#show_hide_password i').addClass("fa-eye");
                    $('#show_hide_password a').prop('title', 'Ocultar contraseña');
                }
            });
        });

        function activarMailP() {
            param = {};
            param.id_parametro = 7;
            param.valor = 0;
            if (document.getElementById("checkActivarMailP").checked == true) {
                param.valor = 1;
                //se muestra el detalle de notificaciones
                $("#checkCreP")[0].checked = true;
                $("#checkCreP").change();
                $("#checkModP")[0].checked = true;
                $("#checkModP").change();
                //$("#checkArc")[0].checked = true;
                //$("#checkArc").change();

                $("#rowNotDetP").show();
            }
            else {
                //se oculta el detalle de notificaciones
                $("#rowNotDetP").hide();

                $("#checkCreP")[0].checked = false;
                $("#checkCreP").change();
                $("#checkModP")[0].checked = false;
                $("#checkModP").change();
                //$("#checkArc")[0].checked = false;
                //$("#checkArc").change();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param), function (data) { onActivarMail(data, param); });
        }

        function onActivarMailP(resultado, param) {
            if (resultado == true) {
                if (param.valor == 0) {
                    showMessage("Notificaciones por mail Desactivadas", "info");
                }
                else {
                    showMessage("Notificaciones por mail Activadas", "info");
                }
            }
            else {
                if (param.valor == 0) {
                    showMessage("Ocurrió un error al intentar desactivar las notificaciones", "error");
                }
                else {
                    showMessage("Ocurrió un error al intentar activar las notificaciones", "error");
                }
            }
        }

        function activarMailDP() {
            param = {};
            param.id_parametro = 7;
            param.valor;
            //envía todas
            if (document.getElementById("checkCreP").checked == true && document.getElementById("checkModP").checked == true) {
                param.valor = 1;
            }
            //envía creacion
            else if (document.getElementById("checkCreP").checked == true && document.getElementById("checkModP").checked == false) {
                param.valor = 2;
            }
            //envía modificacion
            else if (document.getElementById("checkCreP").checked == false && document.getElementById("checkModP").checked == true) {
                param.valor = 3;
            }
            //envía archivado
            //else if (document.getElementById("checkCreP").checked == false && document.getElementById("checkModP").checked == false) {
            //    param.valor = 4;
            //}
            //envía creacion y modificacion
            //else if (document.getElementById("checkCreP").checked == true && document.getElementById("checkModP").checked == true) {
            //    param.valor = 5;
            //}
            //envía creacion y archivado
            //else if (document.getElementById("checkCreP").checked == true && document.getElementById("checkModP").checked == false) {
            //    param.valor = 6;
            //}
            //envía modificacion y archivado
            //else if (document.getElementById("checkCreP").checked == false && document.getElementById("checkModP").checked == true) {
            //    param.valor = 7;
            //}
            //no envía
            else {
                param.valor = 0;
                $("#checkActivarMailP")[0].checked = false;
                $("#checkActivarMailP").change();
                $("#rowNotDetP").hide();
            }
            callWS("medios", "cambiarParam", JSON.stringify(param));
        }

    </script>
    <footer>
        <p style="text-align: center; font-size: x-small;">Powered by <b style="font-size: small;">Strategy Zone S.A. ©</b></p>
    </footer>
</body>
</html>